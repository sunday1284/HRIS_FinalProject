<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security"%>

<style>
/* í€µë©”ë‰´ë°” ìŠ¤íƒ€ì¼ - ê¸°ì¡´ ìœ ì§€ */
.top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    margin-bottom: 20px;
    background-color: transparent; 
    box-shadow: none;
    border: none;
}

/* í˜ì´ì§€ í—¤ë” ìŠ¤íƒ€ì¼ */
.page-header {
    margin-bottom: 1.5rem;
    border-bottom: 1px solid #e9ecef;
    padding-bottom: 1rem;
}

.page-header h2 {
    font-weight: 600;
    color: #2C3E50;
    margin-bottom: 0.5rem;
}

/* ì¹´ë“œ ìŠ¤íƒ€ì¼ ê°œì„  */
.card {
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
    margin-bottom: 2rem;
}

.card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    padding: 1rem 1.5rem;
}

.card-body {
    padding: 1.5rem;
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°œì„  */
.button-container {
    margin-top: 1.5rem;
}

.button-container .btn {
    padding: 8px 20px;
    margin-left: 10px;
    border-radius: 5px;
}

/* ì‚¬ìš©ì—¬ë¶€ ë°°ì§€ ìŠ¤íƒ€ì¼ */
.badge {
    padding: 6px 10px;
    font-weight: 500;
}

/* í…Œì´ë¸” ë§í¬ ìŠ¤íƒ€ì¼ */
table a {
    color: #007bff;
    text-decoration: none;
    font-weight: 500;
}

table a:hover {
    text-decoration: underline;
}

/* í…Œì´ë¸” ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
.form-check-input {
    width: 16px;
    height: 16px;
    margin-right: 5px;
    cursor: pointer;
}

/* í…Œì´ë¸” í–‰ ìŠ¤íƒ€ì¼ */
#approvalTable tbody tr:hover {
    background-color: rgba(0, 123, 255, 0.03);
}
</style>

<!-- í€µë©”ë‰´ë°” ì˜ì—­ - ê¸°ì¡´ ì½”ë“œ ìœ ì§€ -->
<div class="top-bar">
    <!-- ì¢Œì¸¡: ë²„íŠ¼ ê·¸ë£¹ -->
    <div>	 
        <button type="button" class="btn btn-outline-secondary" onclick="history.back();">
            <i class="fas fa-arrow-left"></i> 
        </button>
    </div>
    
    <!-- ìš°ì¸¡: Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item fw-bold text-primary"><a href="${pageContext.request.contextPath}/account/login/home">ğŸ“Œ Main</a> </li>
            <li class="breadcrumb-item"><a href="${pageContext.request.contextPath}/approval/templateList">ê¸°ì•ˆì‘ì„±</a></li>
            <li class="breadcrumb-item"><a href="${pageContext.request.contextPath}/approval/mydrafts">ì œì¶œë¬¸ì„œ</a></li>
            <li class="breadcrumb-item"><a href="${pageContext.request.contextPath}/approval/approverDrafts">ê²°ì¬í˜„í™©</a></li>
            <security:authorize access="hasAnyRole('HR_MANAGER', 'HR_ADMIN')">
                <li class="breadcrumb-item active" aria-current="page">ê²°ì¬ì–‘ì‹</li>
            </security:authorize>
        </ol>
    </nav>
</div>

<!-- ë©”ì¸ ì»¨í…ì¸  ì„¹ì…˜ -->
<div class="container-fluid">
   

    <section class="section">
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-file-alt me-2"></i>ê²°ì¬ ì–‘ì‹ ê´€ë¦¬</h2>
        		<p class="text-muted">ì‚¬ìš© ê°€ëŠ¥í•œ ê²°ì¬ ì–‘ì‹ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            <div class="card-body">
                <!-- ë°ì´í„° í…Œì´ë¸” ì»¨íŠ¸ë¡¤ - ê¸°ì¡´ ì½”ë“œ ìœ ì§€ -->
                <div class="dataTable-wrapper dataTable-loading no-footer sortable searchable fixed-columns">
                    <div class="dataTable-top">                        
                    </div>
                </div>

                <!-- í…Œì´ë¸” - ê¸°ì¡´ ì½”ë“œ ìœ ì§€ -->
                <table id="approvalTable" class="table table-striped datatable">
                    <thead>
                        <tr>
                            <th style="width: 20%;"><a href="#" class="dataTable-sorter">ì–‘ì‹ì½”ë“œ</a></th>
                            <th style="width: 20%;"><a href="#" class="dataTable-sorter">ì œëª©</a></th>
                            <th style="width: 20%;"><a href="#" class="dataTable-sorter">ìµœì¢…ìˆ˜ì •ì</a></th>
                            <th style="width: 15%;"><a href="#" class="dataTable-sorter">ì¹´í…Œê³ ë¦¬</a></th>
                            <th style="width: 15%;"><a href="#" class="dataTable-sorter">ìµœì´ˆë“±ë¡ì¼ì‹œ</a></th>
                            <th style="width: 10%;"><a href="#" class="dataTable-sorter">ë“±ë¡ìê¶Œí•œ</a></th>
                            <th style="width: 10%;"><a href="#" class="dataTable-sorter">ì‚¬ìš©ì—¬ë¶€</a></th>
                        </tr>
                    </thead>
                    <tbody>
                        <c:forEach items="${DraftTemplateList}" var="template">
                            <tr>
                                <td>
                                    <input class="form-check-input" type="checkbox" value="${template.templateId}"/>
                                    ${template.templateId}
                                </td>
                                <td> 
                                    <a href="javascript:void(0);" onclick="TemplateDetail(${template.templateId})" class="text-primary">
                                        ${template.templateTite}
                                    </a>
                                </td>
                                <td>${template.employee.name}</td>
                                <td>${template.templateCategory}</td>
                                <td>
                                    <fmt:formatDate value="${template.templateCreate}" pattern="yyyyë…„ MMì›” ddì¼" />
                                </td>
                                <td>${template.roleName}</td>
                                <td>
                                    <c:choose>
                                        <c:when test="${template.temlpateDeleted eq 'N'}">
                                            <span class="badge bg-success">ì‚¬ìš©ê°€ëŠ¥</span>
                                        </c:when>
                                        <c:otherwise>
                                            <span class="badge bg-danger">ì‚¬ìš©ë¶ˆê°€</span>
                                        </c:otherwise>
                                    </c:choose>
                                </td>
                            </tr>
                        </c:forEach>
                    </tbody>
                </table>

                <!-- ë²„íŠ¼ ì»¨í…Œì´ë„ˆ - ê¸°ì¡´ ì½”ë“œ ìœ ì§€í•˜ë˜ ìŠ¤íƒ€ì¼ë§Œ ê°œì„  -->
                <div class="button-container mb-3" style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-danger" onclick="deleteTemplate()">
                        <i class="fas fa-trash-alt me-1"></i> ì–‘ì‹ ì‚­ì œ
                    </button>
                    <a class="btn btn-primary" href="${pageContext.request.contextPath}/approval/processForm">
                        <i class="fas fa-plus me-1"></i> ì–‘ì‹ ì¶”ê°€
                    </a>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- ë¹„ë™ê¸° ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸ - ê¸°ì¡´ ì½”ë“œ ìœ ì§€ -->
<script type="text/javascript" src="${pageContext.request.contextPath}/resources/js/approval/approvalDelete.js"></script>
<!-- Simple DataTables ìŠ¤í¬ë¦½íŠ¸ - ê¸°ì¡´ ì½”ë“œ ìœ ì§€ -->
<script src="${pageContext.request.contextPath}/assets/extensions/simple-datatables/umd/simple-datatables.js"></script>
<script src="${pageContext.request.contextPath}/resources/template/dist/assets/static/js/pages/simple-datatables.js"></script>

<script>
    // ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€
    function TemplateDetail(templateId) {
        window.location.href = "${pageContext.request.contextPath}/approval/" + templateId;
    }

    // ë°ì´í„° í…Œì´ë¸” ì´ˆê¸°í™” - ê¸°ì¡´ ì½”ë“œ ìœ ì§€
    document.addEventListener("DOMContentLoaded", function () {
        const dataTable = new simpleDatatables.DataTable("#approvalTable", {
            searchable: true,
            fixedHeight: false
        });

        // í˜ì´ì§€ ìˆ˜ ì¡°ì ˆ
        document.getElementById("entriesPerPage").addEventListener("change", function () {
            dataTable.pageLength = parseInt(this.value);
            dataTable.refresh();
        });

        // ê²€ìƒ‰ ê¸°ëŠ¥
        document.getElementById("searchBox").addEventListener("input", function () {
            dataTable.search(this.value);
        });
    });
</script>