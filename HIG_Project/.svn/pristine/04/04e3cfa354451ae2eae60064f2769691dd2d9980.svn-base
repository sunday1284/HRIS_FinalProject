<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>



<style>
  body {
    background: linear-gradient(to right, #f8f9fa, #e9ecef);
    font-family: 'Segoe UI', sans-serif;
  }
  .chart-card {
    background: white;
    border-radius: 1rem;
    padding: 1rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    margin-bottom: 1.5rem;
    height: 360px;
  }
  .section-title {
    font-weight: 600;
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
  }
  .table th, .table td {
    vertical-align: middle;
    text-align: center;
  }
  .table-hover tbody tr:hover {
    background-color: #f1f1f1;
  }
  .btn-primary {
    border-radius: 1rem;
    padding: 0.5rem 1.25rem;
  }
  #table1 th, #table1 td {
    text-align: center;
    vertical-align: middle;
  }
</style>

<div class="page-container container-fluid" style="font-size: 18px;">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div>
      <button type="button" class="btn btn-outline-secondary" onclick="history.back();">
        <i class="fas fa-arrow-left"></i>
      </button>
    </div>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item fw-bold text-primary">
          <a href="${pageContext.request.contextPath }/account/login/home">ğŸ“ŒMain</a>
        </li>
        <li class="breadcrumb-item"><a href="${pageContext.request.contextPath }/employee/empList">ì§ì›ê´€ë¦¬</a></li>
        <li class="breadcrumb-item"><a href="${pageContext.request.contextPath }/employee/appointList">ì¸ì‚¬ë°œë ¹</a></li>
        <li class="breadcrumb-item active" aria-current="page">ê³„ì •ê´€ë¦¬</li>
        <li class="breadcrumb-item"><a href="${pageContext.request.contextPath }/employee/empUpdate/retireList">í‡´ì‚¬ìê´€ë¦¬</a></li>
      </ol>
    </nav>
  </div>
</div>


<div class="container my-5">
  <!-- íƒ€ì´í‹€ -->
  <div class="mb-4">
    <h2 class="fw-bold text-primary">ê³„ì •ê´€ë¦¬</h2>
    <hr>
  </div>

  <div class="row">
    <!-- ì°¨íŠ¸ 1 -->
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-light fw-semibold">ğŸ“Š ê³„ì • ë“±ë¡ í˜„í™©</div>
        <div class="card-body d-flex justify-content-center align-items-center" style="height: 280px;">
          <canvas id="myChart1" width="100%" height="200"></canvas>
        </div>
      </div>
    </div>

    <!-- ì°¨íŠ¸ 2 -->
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-light fw-semibold">ğŸ” ê¶Œí•œë³„ ê³„ì • ìˆ˜</div>
        <div class="card-body d-flex justify-content-center align-items-center" style="height: 280px;">
          <canvas id="myChart3" width="100%" height="200"></canvas>
        </div>
      </div>
    </div>

    <!-- ì°¨íŠ¸ 3 -->
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-light fw-semibold">ğŸš« ë¹„í™œì„± ê³„ì • í˜„í™©</div>
        <div class="card-body d-flex justify-content-center align-items-center" style="height: 280px;">
          <canvas id="myChart2" width="100%" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

    <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="mb-0"></h5>
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id=showRetiredtoggle checked>
            <label class="form-check-label" for="showRetiredtoggle">í‡´ì‚¬ìí¬í•¨</label>
        </div>
    </div>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <div class="alert alert-primary shadow-sm">
        <strong>ğŸ“‚ì—…ë¬´ í”„ë¡œì„¸ìŠ¤</strong>  
        - ì§ì› ë“±ë¡ â†’ ì‹œìŠ¤í…œ ê³„ì • ìë™ ë°œê¸‰ â†’ ê¶Œí•œ ê¸°ë³¸í• ë‹¹ â†’ ìµœì´ˆ ë¡œê·¸ì¸ ë³¸ì¸ì¸ì¦
    </div>
    
        <ul class="nav nav-tabs mb-3" id="accountTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#allAccounts"
                    type="button" role="tab">ì „ì²´ ê³„ì •
            </button>
        </li>
        
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="retired-tab" data-bs-toggle="tab" data-bs-target="#retiredAccounts"
                    type="button" role="tab">í‡´ì‚¬ì ê³„ì • (ë³´ê´€ê¸°ê°„5ë…„)
            </button>
        </li>
    </ul>
    
    
<div class="card">
	<div class="card-body">
		 <table id="allAccountsTable" class="table1 table-bordered table-striped display nowrap w-100">
		    <thead>
			      <tr>
			        <th>ID</th>
			        <th>ì‚¬ì›ëª…</th>
			        <th>ë¶€ì„œ</th>
			        <th>íŒ€</th>
			        <th>ì§ê¸‰</th>
			        <th>ì§ì±…</th>
			        <th>ì…ì‚¬ì¼</th>
			        <th>E-MAIL</th>
			        <th>ê³„ì •ë“±ë¡ì¼</th>
			        <th>ê¶Œí•œ</th>
			        <th>ìƒíƒœ</th>
			        <th>ì ê¸ˆì¼</th>
			      </tr>
		    </thead>
			<tbody>
			   <c:if test="${not empty accountList }">
			 <c:forEach items="${accountList}" var="account">
			    <tr data-retired="${account.accountStatus == 'ë¯¸ì‚¬ìš©' ? 'true' : 'false'}">
			        <td>
			            <a href="#"
			               data-bs-toggle="modal"
			               data-bs-target="#exampleModal"
			               data-mode="detail"
			               data-account-id="${account.accountId}">
			               ${account.accountId}
			            </a>
			        </td>
			        <td>${account.empName }</td>
			        <td>${account.department.departmentName }</td>
			        <td>${account.employee.team.teamName}</td>
			        <td>${account.rank.rankName }</td>
			        <td>${account.job.jobName }</td>
			        <td>${fn:substring(account.employee.hireDate,0,10)  }</td>
			        <td>${account.employee.email }</td>
			        <td>${fn:substring(account.accountDate,0,10)  }</td>
			        <td>ì¼ë°˜ì‚¬ì›</td>
<%-- 			        <td>${account.accountStatus ? "ì‚¬ìš©" : "ë¯¸ì‚¬ìš©" }</td> --%>
					<td onclick="accountStatus(this)" id="accountyn">
			        	<c:choose>
			        		<c:when test="${account.accountStatus eq 'N' }">
			        			<button type="button" class="btn btn-sm btn-danger">ë¯¸ì‚¬ìš©</button>
			        		</c:when>
			        		<c:otherwise>
			        			<button type="button" class="btn btn-sm btn-success">ì‚¬ìš©</button>
			        		</c:otherwise>
			        	</c:choose>
			        </td>
			        
			        <td>${fn:substring(account.accountDel,0,10)  }</td>
			    </tr>
		</c:forEach>
			   </c:if>
			</tbody>
		</table>
	</div>
</div> <!-- ì¬ì§ì or ì „ì²´ ê³„ì • -->


<!-- í‡´ì‚¬ìê³„ì • ê´€ë¦¬ -->
<div class="card">
	<div class="card-body">
		 <table id="retiredAccountDiv" class="table table-striped datatable">
		    <thead>
			      <tr>
			        <th>ID</th>
			        <th>ì‚¬ì›ëª…</th>
			        <th>ë¶€ì„œ</th>
			        <th>íŒ€</th>
			        <th>ì§ê¸‰</th>
			        <th>ì§ì±…</th>
			        <th>ê³„ì •ìœ ì§€ê¸°ê°„</th>
			        <th>ì‚­ì œì˜ˆì •ì¼</th>
			        <th>ìƒíƒœ</th>
			      </tr>
		    </thead>
			<tbody>
			   <c:if test="${not empty retireAccount }">
			 <c:forEach items="${retireAccount}" var="retireAccount">
			    <tr>
			        <td >${retireAccount.accountId }</td>
			        <td>${retireAccount.empName }</td>
			        <td>${retireAccount.department.departmentName }</td>
			        <td>${retireAccount.employee.team.teamName}</td>
			        <td>${retireAccount.rank.rankName }</td>
			        <td>${retireAccount.job.jobName }</td>
			        <td>${fn:substring(retireAccount.accountDate,0,10)  } ~ 
			        ${fn:substring(retireAccount.accountDel,0,10)  }
			        <td>${fn:substring(retireAccount.delete_5year,0,10)  }</td>
			        <td>${retireAccount.accountStatus ? "ì‚¬ìš©" : "ë¯¸ì‚¬ìš©" }</td> <!-- ê³„ì •ìƒíƒœ -->
			    </tr>
		</c:forEach>
		
			   </c:if>
			</tbody>
		</table>
	</div>
</div> <!-- ì¬ì§ì or ì „ì²´ ê³„ì • -->



<div class="d-flex justify-content-end mt-3">
  <form action="/account/insert/formUI" method="get">
    <button type="submit" class="btn btn-primary">+ ì‹ ê·œ ë“±ë¡</button>
  </form>
</div>


<!-- <!-- DataLabelsëŠ” ë‚˜ì¤‘ì— ë¡œë“œ -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script type="text/javascript">
  // EL ë°ì´í„° ë°”ì¸ë”©
  const roleLabels = [];
  const roleCounts = [];

	 <c:forEach var="role" items="${accountRoleCount}">
		  roleLabels.push("${fn:trim(role.role_type)}");
		  roleCounts.push(${role.roleCount}); // ìˆ«ì ê·¸ëŒ€ë¡œ
	</c:forEach>

</script>

<script type="text/javascript">
Chart.register(ChartDataLabels); //  ì „ì—­ ë“±ë¡
const ctx1 = document.getElementById('myChart1');
const ctx2 = document.getElementById('myChart2');
const ctx3 = document.getElementById('myChart3');


const data = {
  labels: ['ì „ì²´ì§ì›','ë“±ë¡ê³„ì •', 'ë¯¸ë“±ë¡ê³„ì •'],
  datasets: [{
    label: 'ê³„ì • ë“±ë¡ í˜„í™©',
    data: [
    	'${totalCount.totalemp}',
    	'${totalCount.totalAccount}',
    	'${totalCount.unRegisterAccount}'
    	],
    backgroundColor: [
      'rgba(54, 162, 235, 0.7)',
      'rgba(75, 192, 192, 0.7)',
      'rgba(255, 159, 64, 0.7)'
    ],
    borderColor: [
      'rgba(54, 162, 235, 1)',
      'rgba(75, 192, 192, 1)',
      'rgba(255, 159, 64, 1)'
    ],
    borderWidth: 1
  }]
};

new Chart(ctx1, {
  type: 'bar',
  data: data,
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: false
      },
      datalabels: {
        anchor: 'end',
        align: 'top',
        color: '#000',
        font: {
          weight: 'bold',
          size: 14
        },
        formatter: (value) => `\${value}ëª…`
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          precision: 0
        }
      }
    }
  },
  plugins: [ChartDataLabels]
});

const disAccountCnt = `${cnt}`;
const deleteAccount = `${deleteAccountCnt}`;
//ê³„ì •ë¹„í™œì„±, ë¹„í™œì„±ì˜ˆì • ì°¨íŠ¸
const data2 = {
  labels: ['ë¹„í™œì„±', 'ê³„ìƒì‚­ì œì˜ˆì •(30ì¼ì´ë‚´)'],
  datasets: [{
    label: 'ë¹„í™œì„±ê³„ì • í˜„í™©',
    data: [disAccountCnt,2]
    ,
    backgroundColor: [
      'rgba(75, 192, 192, 0.7)',
      'rgba(255, 159, 64, 0.7)'
    ],
    borderColor: [
      'rgba(75, 192, 192, 1)',
      'rgba(255, 159, 64, 1)'
    ],
    borderWidth: 1
  }]
};

// ë‘ ë²ˆì§¸ ì°¨íŠ¸ ìƒì„± 
new Chart(ctx2, {
  type: 'bar',
  data: data2, 
  options: {
    responsive: true,
    maintainAspectRatio: false, 
    plugins: {
      legend: { display: false },
      datalabels: {
        anchor: 'end',
        align: 'top',
        color: '#000',
        font: { weight: 'bold', size: 14 },
        formatter: (value) => `\${value}ëª…`
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: { precision: 0 },
        max: 50
      }
    }
  },
  plugins: [ChartDataLabels]
});



//ì°¨íŠ¸ 3: ê³„ì • ê¶Œí•œë³„ í˜„í™© (ê°€ë¡œí˜•)
const data3 = {
  labels: roleLabels,
  datasets: [{
    label: 'ê³„ì • ê¶Œí•œë³´ìœ ',
    data: roleCounts,
    backgroundColor: [
      'rgba(54, 162, 235, 0.7)',
      'rgba(255, 99, 132, 0.7)',
      'rgba(255, 206, 86, 0.7)',
      'rgba(75, 192, 192, 0.7)'
    ],
    borderColor: [
      'rgba(54, 162, 235, 1)',
      'rgba(255, 99, 132, 1)',
      'rgba(255, 206, 86, 1)',
      'rgba(75, 192, 192, 1)'
    ],
    borderWidth: 1
  }]
};

new Chart(ctx3, {
	  type: 'bar',
	  data: data3,
	  options: {
	    indexAxis: 'y',
	    responsive: true,
	    maintainAspectRatio: false,
	    plugins: {
	      legend: { display: false },
	      datalabels: {
	        display: true,
	        clip: false,
	        anchor: 'end',
	        align: 'right',
	        color: '#000',
	        font: { weight: 'bold', size: 10 },
	        formatter: (value) => `\${value}ëª…`
	      }
	    },
	    scales: {
	      x: {
	        beginAtZero: true,
	        ticks: { precision: 0 }
	      }
	    }
	  },
	  plugins: [ChartDataLabels]
	});

</script>

<!--  ëª¨ë‹¬ -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">ìƒì„¸ë³´ê¸°</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning" id="editButton" data-mode="edit">ìˆ˜ì •</button>
        <button type="button" class="btn btn-success" id="saveButton" style="display: none;">ì €ì¥</button>
        <button type="button" class="btn btn-secondary" id="closeButton" data-bs-dismiss="modal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</div>

<!--  ë³„ë„ JavaScript íŒŒì¼ -->
<script src="${pageContext.request.contextPath}/resources/js/account/accountList.js"></script>
<script src="${pageContext.request.contextPath}/resources/js/account/accountEdit.js"></script>
<script src="${pageContext.request.contextPath}/resources/js/account/disabledAccount.js"></script>

