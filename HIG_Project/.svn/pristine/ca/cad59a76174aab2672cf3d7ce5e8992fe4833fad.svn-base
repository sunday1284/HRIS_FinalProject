<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://www.springframework.org/security/tags"
    prefix="security"%>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²°ì¬í˜„í™©</title>

  <!-- DataTables CSS (CDN ì˜ˆì‹œ) -->
  <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">

  <style>
    /********************************************************
     * ì „ì—­ ìŠ¤íƒ€ì¼ / í…Œì´ë¸” / ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ë“±
     ********************************************************/
    .dashboard-container {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .table-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .summary-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .stat-card {
      flex: 1;
      min-width: 120px;
      padding: 1rem;
      text-align: center;
      background: #f8f9fa;
      border-radius: .5rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .stat-card .stat-title {
      font-size: .9rem;
      color: #6c757d;
      margin-bottom: .5rem;
    }
    .stat-card .stat-value .badge {
      font-size: 1.2rem;
      font-weight: bold;
    }
    .data-visualization {
      display: flex;
      justify-content: center;
      margin-bottom: 1.5rem;
    }
    .chart-container {
      max-width: 400px;
      width: 100%;
      padding: 1rem;
      background: #fff;
      border-radius: .5rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .chart-container canvas {
      width: 100% !important;
      height: auto !important;
    }
    .table-container {
      background: #fff;
      padding: 1rem;
      border-radius: .5rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /********************************************************
     * í…Œì´ë¸” í•„í„° ë°” (ìƒíƒœ/ê±´ìˆ˜/ê²€ìƒ‰ ë“±) - í¬ê¸°, ê°„ê²©, í°íŠ¸ ì¡°ì •
     ********************************************************/
    .table-filters {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 1rem;   /* í•„í„°ë“¤ ì‚¬ì´ ê°„ê²© */
    }

    /* í•„í„° ì»¨íŠ¸ë¡¤(Select, Input, Button) ì „ë°˜ì ì¸ í¬ê¸° í‚¤ìš°ê¸° */
    .table-filters .form-select-sm,
    .table-filters .form-control-sm,
    .table-filters .btn {
      display: inline-block;
      width: auto;
      margin: 0;
      font-size: 1rem;       
      padding: 0.5rem 0.75rem;
      line-height: 1.5;
      height: auto;          
    }

    /* ê²€ìƒ‰ì°½ì˜ ê¸°ë³¸ í­ í™•ë³´ */
    #searchInput {
      min-width: 180px;   
    }

    /* ê±´ìˆ˜ ì„ íƒ ë°•ìŠ¤ì˜ ìµœì†Œ ë„ˆë¹„ í™•ë³´ (ì´ ë¶€ë¶„ì´ í•µì‹¬) */
    .table-filters #rowsPerPage {
      min-width: 80px;   /* í•„ìš”í•œ ë§Œí¼ ì¡°ì ˆ ê°€ëŠ¥ */
    }

    /* ë²„íŠ¼ì€ ì•½ê°„ ë” ë„‰ë„‰í•œ í­ */
    .table-filters .btn {
      padding: 0.5rem 1rem;
    }

    /* ë¼ë²¨ ê°„ê²© ë° ì¤„ë°”ê¿ˆ ë°©ì§€ */
    .table-filters label {
      margin: 0 0.5rem 0 0;  /* ë¼ë²¨ ì˜¤ë¥¸ìª½ ê°„ê²© ì¡°ì ˆ */
      white-space: nowrap;
      font-size: 1rem;
    }

    /********************************************************
     * ë°°ì§€ / ìŠ¹ì¸ìëª… ë“± ìŠ¤íƒ€ì¼
     ********************************************************/
    .badge-status {
      display: inline-block;
      min-width: 50px;
      text-align: center;
      padding: 0.4em 0.7em;
      font-size: 0.8rem;
      color: #fff;
      border-radius: 0.4rem;
    }
    .approver-name {
      margin-left: 4px;
      color: #666;
      font-size: 0.8rem;
    }

    /********************************************************
     * ë§í¬ ìŠ¤íƒ€ì¼, í‘œ ë³¸ë¬¸ í°íŠ¸
     ********************************************************/
    a:link, a:visited {
      color: #435EBE;
      font-size: 16px;
    }
    /* DataTablesì—ì„œ ìƒì„±ë˜ëŠ” í–‰, í°íŠ¸ í¬ê¸° í†µì¼ */
    #approverTable tbody tr,
    #approverTable tbody td {
      font-size: 16px !important;
      line-height: 1.5 !important;
    }

    /********************************************************
     * í—¤ë”, BreadCrumb ë“± ìƒë‹¨ ë°”
     ********************************************************/
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      margin-bottom: 20px;
      background-color: transparent;
      box-shadow: none;
      border: none;
    }

    .next-approver-arrow {
      margin-left: 6px;
      color: #444;
      font-weight: bold;
    }
  </style>

  <!-- (ì˜µì…˜) Chart.js + summary ì—…ë°ì´íŠ¸ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="${pageContext.request.contextPath}/resources/js/approval/approverChart.js"></script>
</head>
<body>
<div class="top-bar">
    <!-- ì¢Œì¸¡: ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
    <div>
      <button type="button" class="btn btn-outline-secondary" onclick="history.back();">
        <i class="fas fa-arrow-left"></i>
      </button>
    </div>

    <!-- ìš°ì¸¡: Breadcrumb -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item fw-bold text-primary">
          <a href="${pageContext.request.contextPath}/account/login/home">ğŸ“Œ Main</a>
        </li>
        <li class="breadcrumb-item">
          <a href="${pageContext.request.contextPath}/approval/templateList">ê¸°ì•ˆì‘ì„±</a>
        </li>
        <li class="breadcrumb-item">
          <a href="${pageContext.request.contextPath}/approval/mydrafts">ì œì¶œë¬¸ì„œ</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">ê²°ì¬í˜„í™©</li>
        <security:authorize access="hasAnyRole('HR_MANAGER', 'HR_ADMIN')">
          <li class="breadcrumb-item">
            <a href="${pageContext.request.contextPath}/approval/list">ê²°ì¬ì–‘ì‹</a>
          </li>
        </security:authorize>
      </ol>
    </nav>
</div>

<section class="section">
  <div class="card">
    <!-- ì¹´ë“œ í—¤ë” -->
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2 class="mb-0">ê²°ì¬í˜„í™©</h2>
      <div>
        <a class="btn btn-primary btn-sm" href="${pageContext.request.contextPath}/approval/templateList">ê¸°ì•ˆì‘ì„±</a>
        <button class="btn btn-outline-secondary btn-sm" onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
      </div>
    </div>

    <!-- ì¹´ë“œ ë°”ë”” -->
    <div class="card-body dashboard-container">
      <!-- ìš”ì•½ ì¹´ë“œ (ì˜µì…˜) -->
      <div class="summary-stats">
        <div class="stat-card">
          <div class="stat-title">ëŒ€ê¸°</div>
          <div class="stat-value">
            <span class="badge bg-secondary" data-status="ëŒ€ê¸°">0</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-title">ì§„í–‰ì¤‘</div>
          <div class="stat-value">
            <span class="badge bg-info" data-status="ì§„í–‰ì¤‘">0</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-title">ìŠ¹ì¸</div>
          <div class="stat-value">
            <span class="badge bg-success" data-status="ìŠ¹ì¸">0</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-title">ë°˜ë ¤</div>
          <div class="stat-value">
            <span class="badge bg-danger" data-status="ë°˜ë ¤">0</span>
          </div>
        </div>
      </div>

      <!-- (ì˜µì…˜) ì°¨íŠ¸ ì˜ì—­ -->
      <!-- í•„í„° ë°” -->
      <div class="table-header">
        <div class="table-filters">
          <label for="statusFilter">ìƒíƒœ:</label>
          <select id="statusFilter" class="form-select form-select-sm">
            <option value="all">ì „ì²´</option>
            <option value="draft">ëŒ€ê¸°</option>
            <option value="process">ì§„í–‰ì¤‘</option>
            <option value="approved">ìŠ¹ì¸</option>
            <option value="rejected">ë°˜ë ¤</option>
          </select>

          <label for="rowsPerPage">ê±´ìˆ˜:</label>
          <select id="rowsPerPage" class="form-select form-select-sm">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="50">50</option>
          </select>

          <input type="text" id="searchInput" class="form-control form-control-sm" placeholder="ê²€ìƒ‰">
          <button id="searchBtn" class="btn btn-sm btn-primary">ê²€ìƒ‰</button>
        </div>
      </div>

      <!-- í…Œì´ë¸” -->
      <table id="approverTable" class="table table-striped">
        <thead>
          <tr>
            <th>ë¬¸ì„œID</th>
            <th>ì œëª©</th>
            <th>ê¸°ì•ˆì¼</th>
            <th>ê¸°ì•ˆì</th>
            <th>ë¶€ì„œ</th>
            <th>ê²°ì¬ì</th>
            <th>ìƒíƒœ</th>
          </tr>
        </thead>
        <tbody id="approverTable" style="width: 100%;">
          <!-- JSì—ì„œ <tr>ì„ ìƒì„±í•˜ì—¬ ì‚½ì… -->
        </tbody>
      </table>
    </div> <!-- //card-body -->
  </div> <!-- //card -->
</section>

<!-- jQuery, DataTables JS (CDN ì˜ˆì‹œ) -->
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

<!-- JSPì—ì„œ contextPathë¥¼ JS ì „ì—­ë³€ìˆ˜ë¡œ ì„¤ì • -->
<script type="text/javascript">
  var ctx = '${pageContext.request.contextPath}';
</script>

<!-- í†µí•© ìŠ¤í¬ë¦½íŠ¸ (ctx, jQuery, DataTables ëª¨ë‘ ë¡œë“œëœ í›„) -->
<script type="module" src="${pageContext.request.contextPath}/resources/js/approval/approverCombined.js"></script>

</body>
</html>
